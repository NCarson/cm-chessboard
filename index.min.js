!function r(a,o,h){function u(t,e){if(!o[t]){if(!a[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(c)return c(t,!0);var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}var n=o[t]={exports:{}};a[t][0].call(n.exports,function(e){return u(a[t][1][e]||e)},n,n.exports,r,a,o,h)}return o[t].exports}for(var c="function"==typeof require&&require,e=0;e<h.length;e++)u(h[e]);return u}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Chessboard=i.FEN_EMPTY_POSITION=i.FEN_START_POSITION=i.PIECE=i.MARKER_TYPE=i.INPUT_EVENT_TYPE=i.MOVE_INPUT_MODE=i.COLOR=void 0;var s=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}(),r=e("./ChessboardView.js"),a=e("./ChessboardState.js");var o=i.COLOR={white:"w",black:"b"},h=i.MOVE_INPUT_MODE={viewOnly:0,dragPiece:1,dragMarker:2},u=i.INPUT_EVENT_TYPE={moveStart:"moveStart",moveDone:"moveDone",moveCanceled:"moveCanceled",context:"context"},c=i.MARKER_TYPE={move:{class:"move",slice:"marker1"},emphasize:{class:"emphasize",slice:"marker2"}},d=(i.PIECE={whitePawn:"wp",whiteBishop:"wb",whiteKnight:"wn",whiteRook:"wr",whiteQueen:"wq",whiteKing:"wk",blackPawn:"bp",blackBishop:"bb",blackKnight:"bn",blackRook:"br",blackQueen:"bq",blackKing:"bk"},i.FEN_START_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),l=i.FEN_EMPTY_POSITION="8/8/8/8/8/8/8/8";i.Chessboard=function(){function n(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.element=e,this.props={position:"empty",orientation:o.white,style:{cssClass:"default",showCoordinates:!0,showBorder:!1},responsive:!1,animationDuration:300,moveInputMode:h.viewOnly,sprite:{url:"./assets/images/chessboard-sprite.svg",grid:40}},Object.assign(this.props,i),this.props.sprite.grid||(this.props.sprite.grid=40),this.state=new a.ChessboardState,this.state.orientation=this.props.orientation,this.initialization=new Promise(function(e){t.view=new r.ChessboardView(t,function(){"start"===t.props.position?t.state.setPosition(d):"empty"===t.props.position||null===t.props.position?t.state.setPosition(l):t.state.setPosition(t.props.position),setTimeout(function(){t.view.redraw().then(function(){e()})})})}).then(function(){s&&(console.warn("warning: the constructor callback is deprecated and will be removed in future versions"),s(t))})}return s(n,[{key:"setPiece",value:function(t,i){var s=this;return new Promise(function(e){s.initialization.then(function(){s.state.setPiece(s.state.squareToIndex(t),i),s.view.drawPiecesDebounced(s.state.squares,function(){e()})})})}},{key:"getPiece",value:function(e){return this.state.squares[this.state.squareToIndex(e)]}},{key:"setPosition",value:function(s){var n=this,r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return new Promise(function(i){n.initialization.then(function(){var e=n.state.getPosition();if(s.split(" ")[0]!==e){var t=n.state.squares.slice(0);"start"===s?n.state.setPosition(d):"empty"===s||null===s?n.state.setPosition(l):n.state.setPosition(s),r?n.view.animatePieces(t,n.state.squares.slice(0),function(){i()}):(n.view.drawPiecesDebounced(),i())}else i()})})}},{key:"getPosition",value:function(){return this.state.getPosition()}},{key:"addMarker",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:c.emphasize;this.state.addMarker(this.state.squareToIndex(e),t),this.view.drawMarkersDebounced()}},{key:"getMarkers",value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=[];return this.state.markers.forEach(function(e){var t=a.SQUARE_COORDINATES[e.index];(null===i&&(null===s||s===e.type)||null===s&&i===t||s===e.type&&i===t)&&n.push({square:a.SQUARE_COORDINATES[e.index],type:e.type})}),n}},{key:"removeMarkers",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=null!==e?this.state.squareToIndex(e):null;this.state.removeMarkers(i,t),this.view.drawMarkersDebounced()}},{key:"setOrientation",value:function(e){this.state.orientation=e,this.view.redraw()}},{key:"getOrientation",value:function(){return this.state.orientation}},{key:"destroy",value:function(){var t=this;return new Promise(function(e){t.initialization.then(function(){t.view.destroy(),t.view=null,t.state=null,t.element.removeEventListener("contextmenu",t.contextMenuListener),e()})})}},{key:"enableMoveInput",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(this.props.moveInputMode===h.viewOnly)throw Error("props.moveInputMode is MOVE_INPUT_MODE.viewOnly");t===o.white?this.state.inputWhiteEnabled=!0:(t===o.black||(this.state.inputWhiteEnabled=!0),this.state.inputBlackEnabled=!0),this.moveInputCallback=e,this.view.setCursor()}},{key:"disableMoveInput",value:function(){this.state.inputWhiteEnabled=!1,this.state.inputBlackEnabled=!1,this.moveInputCallback=null,this.view.setCursor()}},{key:"enableContextInput",value:function(i){this.contextMenuListener?console.warn("contextMenuListener already existing"):(this.contextMenuListener=function(e){e.preventDefault();var t=e.target.getAttribute("data-index");i({chessboard:this,type:u.context,square:a.SQUARE_COORDINATES[t]})},this.element.addEventListener("contextmenu",this.contextMenuListener))}},{key:"disableContextInput",value:function(){this.element.removeEventListener("contextmenu",this.contextMenuListener)}}]),n}()},{"./ChessboardState.js":4,"./ChessboardView.js":5}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ChessboardMoveInput=void 0;var s=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}(),r=e("../svjs-svg/src/svjs-svg/Svg.js"),o=e("./Chessboard.js");var h={waitForInputStart:0,pieceClickedThreshold:1,clickTo:2,secondClickThreshold:3,dragTo:4,clickDragTo:5,moveDone:6,reset:7};i.ChessboardMoveInput=function(){function a(e,t,i,s,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.view=e,this.state=t,this.props=i,this.moveStartCallback=s,this.moveDoneCallback=n,this.moveCanceledCallback=r,this.setMoveInputState(h.waitForInputStart)}return s(a,[{key:"setMoveInputState",value:function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,s=this.moveInputState;switch(this.moveInputState=e){case h.waitForInputStart:break;case h.pieceClickedThreshold:if(h.waitForInputStart!==s)throw new Error("moveInputState");if(this.startIndex=i.index,this.endIndex=null,this.movedPiece=i.piece,this.updateStartEndMarkers(),this.startPoint=i.point,this.pointerMoveListener||this.pointerUpListener)throw Error("_pointerMoveListener or _pointerUpListener");if("mousedown"===i.type)this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",window.addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",window.addEventListener("mouseup",this.pointerUpListener);else{if("touchstart"!==i.type)throw Error("event type");this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",window.addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",window.addEventListener("touchend",this.pointerUpListener)}break;case h.clickTo:this.dragablePiece&&(r.Svg.removeElement(this.dragablePiece),this.dragablePiece=null),s===h.dragTo&&this.view.setPieceVisibility(i.index);break;case h.secondClickThreshold:if(h.clickTo!==s)throw new Error("moveInputState");this.startPoint=i.point;break;case h.dragTo:if(h.pieceClickedThreshold!==s)throw new Error("moveInputState");this.props.moveInputMode===o.MOVE_INPUT_MODE.dragPiece&&(this.view.setPieceVisibility(i.index,!1),this.createDragablePiece(i.piece));break;case h.clickDragTo:if(h.secondClickThreshold!==s)throw new Error("moveInputState");this.props.moveInputMode===o.MOVE_INPUT_MODE.dragPiece&&(this.view.setPieceVisibility(i.index,!1),this.createDragablePiece(i.piece));break;case h.moveDone:if(-1===[h.dragTo,h.clickTo,h.clickDragTo].indexOf(s))throw new Error("moveInputState");if(this.endIndex=i.index,this.endIndex&&this.moveDoneCallback(this.startIndex,this.endIndex)){var n=this.state.squares.slice(0);this.state.setPiece(this.startIndex,null),this.state.setPiece(this.endIndex,this.movedPiece),s===h.clickTo?this.view.animatePieces(n,this.state.squares.slice(0),function(){t.setMoveInputState(h.reset)}):(this.view.drawPieces(this.state.squares),this.setMoveInputState(h.reset))}else this.view.drawPiecesDebounced(),this.setMoveInputState(h.reset);break;case h.reset:this.startIndex&&!this.endIndex&&this.movedPiece&&this.state.setPiece(this.startIndex,this.movedPiece),this.startIndex=null,this.endIndex=null,this.movedPiece=null,this.updateStartEndMarkers(),this.dragablePiece&&(r.Svg.removeElement(this.dragablePiece),this.dragablePiece=null),this.pointerMoveListener&&(window.removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(window.removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.setMoveInputState(h.waitForInputStart);break;default:throw Error("moveInputState "+e)}}},{key:"createDragablePiece",value:function(e){if(this.dragablePiece)throw Error("dragablePiece exists");this.dragablePiece=r.Svg.createSvg(document.body),this.dragablePiece.setAttribute("width",this.view.squareWidth),this.dragablePiece.setAttribute("height",this.view.squareHeight),this.dragablePiece.setAttribute("style","pointer-events: none"),this.dragablePiece.name=e;var t=r.Svg.addElement(this.dragablePiece,"use",{href:"#"+e}),i=this.view.squareHeight/this.props.sprite.grid,s=this.dragablePiece.createSVGTransform();s.setScale(i,i),t.transform.baseVal.appendItem(s)}},{key:"moveDragablePiece",value:function(e,t){this.dragablePiece.setAttribute("style","pointer-events: none; position: absolute; left: "+(e-this.view.squareHeight/2)+"px; top: "+(t-this.view.squareHeight/2)+"px")}},{key:"onPointerDown",value:function(e){if("mousedown"===e.type&&0===e.button||"touchstart"===e.type){var t=e.target.getAttribute("data-index"),i=this.view.getPiece(t);if(void 0!==t){var s=void 0,n=void 0;if(i&&(n=(s=i.getAttribute("data-piece"))?s.substr(0,1):null),this.moveInputState!==h.waitForInputStart||this.state.inputWhiteEnabled&&"w"===n||this.state.inputBlackEnabled&&"b"===n){var r=void 0;"mousedown"===e.type?r={x:e.clientX,y:e.clientY}:"touchstart"===e.type&&(r={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===h.waitForInputStart&&s&&this.moveStartCallback(t)?this.setMoveInputState(h.pieceClickedThreshold,{index:t,piece:s,point:r,type:e.type}):this.moveInputState===h.clickTo&&(t===this.startIndex?this.setMoveInputState(h.secondClickThreshold,{index:t,piece:s,point:r,type:e.type}):this.setMoveInputState(h.moveDone,{index:t}))}}}}},{key:"onPointerMove",value:function(e){var t=void 0,i=void 0,s=void 0;if("mousemove"===e.type?(t=e.pageX,i=e.pageY,s=e.target):"touchmove"===e.type&&(t=e.touches[0].pageX,i=e.touches[0].pageY,s=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY)),this.moveInputState===h.pieceClickedThreshold||this.moveInputState===h.secondClickThreshold)(2<Math.abs(this.startPoint.x-t)||2<Math.abs(this.startPoint.y-i))&&(this.moveInputState===h.secondClickThreshold?this.setMoveInputState(h.clickDragTo,{index:this.startIndex,piece:this.movedPiece}):this.setMoveInputState(h.dragTo,{index:this.startIndex,piece:this.movedPiece}),this.props.moveInputMode===o.MOVE_INPUT_MODE.dragPiece&&this.moveDragablePiece(t,i));else if(this.moveInputState===h.dragTo||this.moveInputState===h.clickDragTo||this.moveInputState===h.clickTo){if(s&&s.getAttribute&&s.parentElement===this.view.boardGroup){var n=s.getAttribute("data-index");n!==this.startIndex&&n!==this.endIndex?(this.endIndex=n,this.updateStartEndMarkers()):n===this.startIndex&&null!==this.endIndex&&(this.endIndex=null,this.updateStartEndMarkers())}else this.endIndex=null,this.updateStartEndMarkers();this.props.moveInputMode!==o.MOVE_INPUT_MODE.dragPiece||this.moveInputState!==h.dragTo&&this.moveInputState!==h.clickDragTo||this.moveDragablePiece(t,i)}}},{key:"onPointerUp",value:function(e){var t=void 0,i=void 0,s=void 0;if("mouseup"===e.type?s=e.target:"touchend"===e.type&&(t=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY,s=document.elementFromPoint(t,i)),s&&s.getAttribute){var n=s.getAttribute("data-index");n?this.moveInputState===h.dragTo||this.moveInputState===h.clickDragTo?this.startIndex===n?this.moveInputState===h.clickDragTo?(this.state.setPiece(this.startIndex,this.movedPiece),this.view.setPieceVisibility(this.startIndex),this.setMoveInputState(h.reset)):this.setMoveInputState(h.clickTo,{index:n}):this.setMoveInputState(h.moveDone,{index:n}):this.moveInputState===h.pieceClickedThreshold?this.setMoveInputState(h.clickTo,{index:n}):this.moveInputState===h.secondClickThreshold&&(this.setMoveInputState(h.reset),this.moveCanceledCallback()):(this.view.drawPiecesDebounced(),this.setMoveInputState(h.reset),this.moveCanceledCallback())}else this.view.drawPiecesDebounced(),this.setMoveInputState(h.reset)}},{key:"updateStartEndMarkers",value:function(){this.state.removeMarkers(null,o.MARKER_TYPE.move),this.startIndex&&this.state.addMarker(this.startIndex,o.MARKER_TYPE.move),this.endIndex&&this.state.addMarker(this.endIndex,o.MARKER_TYPE.move),this.view.drawMarkersDebounced()}},{key:"destroy",value:function(){this.setMoveInputState(h.reset)}}]),a}()},{"../svjs-svg/src/svjs-svg/Svg.js":6,"./Chessboard.js":1}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}();var u=0,c=1,d=2;function a(){}i.ChessboardPiecesAnimation=function(){function r(e,t,i,s,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.view=e,this.view.animationRunning)throw new a;t&&i&&(this.animatedElements=this.createAnimation(t,i),this.duration=s,this.callback=n,this.view.animationRunning=!0,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this)))}return s(r,[{key:"seekChanges",value:function(e,t){for(var r=this,i=[],a=[],o=[],s=0;s<64;s++){var n=e[s],h=t[s];h!==n&&(h&&i.push({piece:h,index:s}),n&&a.push({piece:n,index:s}))}return i.forEach(function(i){var s=8,n=null;a.forEach(function(e){if(i.piece===e.piece){var t=r.squareDistance(i.index,e.index);t<s&&(n=e,s=t)}}),n?(a.splice(a.indexOf(n),1),o.push({type:u,piece:i.piece,atIndex:n.index,toIndex:i.index})):o.push({type:c,piece:i.piece,atIndex:i.index})}),a.forEach(function(e){o.push({type:d,piece:e.piece,atIndex:e.index})}),o}},{key:"createAnimation",value:function(e,t){var i=this,s=this.seekChanges(e,t),n=[];return s.forEach(function(e){var t={type:e.type};switch(e.type){case u:t.element=i.view.getPiece(e.atIndex),t.atPoint=i.view.squareIndexToPoint(e.atIndex),t.toPoint=i.view.squareIndexToPoint(e.toIndex);break;case c:t.element=i.view.drawPiece(e.atIndex,e.piece),t.element.style.opacity=0;break;case d:t.element=i.view.getPiece(e.atIndex)}n.push(t)}),n}},{key:"animationStep",value:function(e){var i=this;this.startTime||(this.startTime=e);var t=e-this.startTime;t<=this.duration?this.frameHandle=requestAnimationFrame(this.animationStep.bind(this)):(cancelAnimationFrame(this.frameHandle),this.view.animationRunning=!1,this.callback());var s=Math.min(1,t/this.duration),n=s<.5?2*s*s:(4-2*s)*s-1;this.animatedElements.forEach(function(e){if(e.element)switch(e.type){case u:e.element.transform.baseVal.removeItem(0);var t=i.view.svg.createSVGTransform();t.setTranslate(e.atPoint.x+(e.toPoint.x-e.atPoint.x)*n,e.atPoint.y+(e.toPoint.y-e.atPoint.y)*n),e.element.transform.baseVal.appendItem(t);break;case c:e.element.style.opacity=n;break;case d:e.element.style.opacity=1-n}else console.warn("animatedItem has no element",e)})}},{key:"squareDistance",value:function(e,t){var i=e%8,s=Math.floor(e/8),n=t%8,r=Math.floor(t/8);return Math.max(Math.abs(r-s),Math.abs(n-i))}}]),r}()},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}();i.SQUARE_COORDINATES=["a1","b1","c1","d1","e1","f1","g1","h1","a2","b2","c2","d2","e2","f2","g2","h2","a3","b3","c3","d3","e3","f3","g3","h3","a4","b4","c4","d4","e4","f4","g4","h4","a5","b5","c5","d5","e5","f5","g5","h5","a6","b6","c6","d6","e6","f6","g6","h6","a7","b7","c7","d7","e7","f7","g7","h7","a8","b8","c8","d8","e8","f8","g8","h8"],i.ChessboardState=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.squares=new Array(64).fill(null),this.orientation=null,this.markers=[]}return s(e,[{key:"setPiece",value:function(e,t){this.squares[e]=t}},{key:"addMarker",value:function(e,t){this.markers.push({index:e,type:t})}},{key:"removeMarkers",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.markers=null===t&&null===i?[]:this.markers.filter(function(e){if(null===e.type){if(t===e.index)return!1}else if(null===t){if(e.type===i)return!1}else if(e.type===i&&t===e.index)return!1;return!0})}},{key:"setPosition",value:function(e){if(e)for(var t=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/),i=0;i<8;i++)for(var s=t[7-i].replace(/\d/g,function(e){for(var t=parseInt(e),i="",s=0;s<t;s++)i+="-";return i}),n=0;n<8;n++){var r=s.substr(n,1),a=null;"-"!==r&&(a=r.toUpperCase()===r?"w"+r.toLowerCase():"b"+r),this.squares[8*i+n]=a}}},{key:"getPosition",value:function(){for(var e=new Array(8).fill(""),t=0;t<8;t++){for(var i=0,s=0;s<8;s++){var n=this.squares[8*t+s];if(null===n)i++;else{0<i&&(e[7-t]+=i,i=0);var r=n.substr(0,1),a=n.substr(1,1);e[7-t]+="w"===r?a.toUpperCase():a}}0<i&&(e[7-t]+=i,i=0)}return e.join("/")}},{key:"squareToIndex",value:function(e){var t=e.substr(0,1).charCodeAt(0)-97;return 8*(e.substr(1,1)-1)+t}}]),e}()},{}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ChessboardView=void 0;var n=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}(),d=e("../svjs-svg/src/svjs-svg/Svg.js"),r=e("./ChessboardState.js"),a=e("./ChessboardMoveInput.js"),l=e("./Chessboard.js"),o=e("./ChessboardPiecesAnimation.js");var h=1,u=2,c=3;(i.ChessboardView=function(){function s(e,t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.animationRunning=!1,this.currentAnimation=null,this.chessboard=e,this.spriteLoadWaitingTries=0,this.loadSprite(e.props,function(){i.spriteLoadWaitDelay=0,i.moveInput=new a.ChessboardMoveInput(i,e.state,e.props,i.moveStartCallback.bind(i),i.moveDoneCallback.bind(i),i.moveCanceledCallback.bind(i)),i.animationQueue=[],e.props.responsive&&(i.resizeListener=i.handleResize.bind(i),window.addEventListener("resize",i.resizeListener)),e.props.moveInputMode!==l.MOVE_INPUT_MODE.viewOnly&&(i.pointerDownListener=i.pointerDownHandler.bind(i),i.chessboard.element.addEventListener("mousedown",i.pointerDownListener),i.chessboard.element.addEventListener("touchstart",i.pointerDownListener)),i.createSvgAndGroups(),i.updateMetrics(),t()})}return n(s,[{key:"pointerDownHandler",value:function(e){e.preventDefault(),this.moveInput.onPointerDown(e)}},{key:"destroy",value:function(){this.moveInput.destroy(),window.removeEventListener("resize",this.resizeListener),this.chessboard.element.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.element.removeEventListener("touchstart",this.pointerDownListener),window.clearTimeout(this.resizeDebounce),window.clearTimeout(this.redrawDebounce),window.clearTimeout(this.drawPiecesDebounce),window.clearTimeout(this.drawMarkersDebounce),d.Svg.removeElement(this.svg),this.animationQueue=[],this.currentAnimation&&cancelAnimationFrame(this.currentAnimation.frameHandle)}},{key:"loadSprite",value:function(e,t){var i=this;s.spriteLoadingStatus===h?(s.spriteLoadingStatus=u,d.Svg.loadSprite(e.sprite.url,["wk","wq","wr","wb","wn","wp","bk","bq","br","bb","bn","bp","marker1","marker2"],function(){s.spriteLoadingStatus=c,t()},e.sprite.grid)):s.spriteLoadingStatus===u?(setTimeout(function(){i.spriteLoadWaitingTries++,i.spriteLoadWaitingTries<50?i.loadSprite(e,t):console.error("timeout loading sprite",e.sprite.url)},this.spriteLoadWaitDelay),this.spriteLoadWaitDelay+=10):s.spriteLoadingStatus===c?t():console.error("error ChessboardView.spriteLoadingStatus",s.spriteLoadingStatus)}},{key:"createSvgAndGroups",value:function(){this.svg&&d.Svg.removeElement(this.svg),this.svg=d.Svg.createSvg(this.chessboard.element);var e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.chessboard.props.style.showBorder?this.svg.setAttribute("class","cm-chessboard has-border "+e):this.svg.setAttribute("class","cm-chessboard "+e),this.updateMetrics(),this.boardGroup=d.Svg.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=d.Svg.addElement(this.svg,"g",{class:"coordinates"}),this.markersGroup=d.Svg.addElement(this.svg,"g",{class:"markers"}),this.piecesGroup=d.Svg.addElement(this.svg,"g",{class:"pieces"})}},{key:"updateMetrics",value:function(){this.width=this.chessboard.element.offsetWidth,this.height=this.chessboard.element.offsetHeight,this.chessboard.props.style.showBorder?this.borderSize=this.width/32:this.borderSize=this.width/320,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/this.chessboard.props.sprite.grid,this.scalingY=this.squareHeight/this.chessboard.props.sprite.grid,this.pieceXTranslate=this.squareWidth/2-this.chessboard.props.sprite.grid*this.scalingY/2}},{key:"handleResize",value:function(){var e=this;window.clearTimeout(this.resizeDebounce),this.resizeDebounce=setTimeout(function(){e.chessboard.element.offsetWidth===e.width&&e.chessboard.element.offsetHeight===e.height||(e.updateMetrics(),e.redraw())})}},{key:"redraw",value:function(){var t=this;return new Promise(function(e){window.clearTimeout(t.redrawDebounce),t.redrawDebounce=setTimeout(function(){t.drawBoard(),t.drawCoordinates(),t.drawMarkers(),t.setCursor()}),t.drawPiecesDebounced(t.chessboard.state.squares,function(){e()})})}},{key:"drawBoard",value:function(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(d.Svg.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.showBorder){var e=this.borderSize-this.borderSize/9;d.Svg.addElement(this.boardGroup,"rect",{x:e,y:e,width:this.width-2*e,height:this.height-2*e}).setAttribute("class","border-inner")}for(var t=0;t<64;t++){var i=this.chessboard.state.orientation===l.COLOR.white?t:63-t,s="square "+(0==(9*i&8)?"black":"white"),n=this.squareIndexToPoint(i),r=d.Svg.addElement(this.boardGroup,"rect",{x:n.x,y:n.y,width:this.squareWidth,height:this.squareHeight});r.setAttribute("class",s),r.setAttribute("data-index",""+i)}}},{key:"drawCoordinates",value:function(){if(this.chessboard.props.style.showCoordinates){for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);for(var e=!this.chessboard.props.style.showBorder,t=0;t<8;t++){var i=this.borderSize+(18+this.chessboard.props.sprite.grid*t)*this.scalingX,s=this.height-2.6*this.scalingY,n="coordinate file";e&&(i+=15.5*this.scalingX,this.chessboard.props.style.showBorder&&(s-=11*this.scalingY),n+=t%2?" dark":" light");var r=d.Svg.addElement(this.coordinatesGroup,"text",{class:n,x:i,y:s,style:"font-size: "+8*this.scalingY+"px"});this.chessboard.state.orientation===l.COLOR.white?r.textContent=String.fromCharCode(97+t):r.textContent=String.fromCharCode(104-t)}for(var a=0;a<8;a++){var o=this.borderSize/3.7,h=this.borderSize+24*this.scalingY+a*this.squareHeight,u="coordinate rank";e&&(u+=a%2?" light":" dark",this.chessboard.props.style.showBorder?o+=10*this.scalingX:o+=2*this.scalingX,h-=15*this.scalingY);var c=d.Svg.addElement(this.coordinatesGroup,"text",{class:u,x:o,y:h,style:"font-size: "+8*this.scalingY+"px"});this.chessboard.state.orientation===l.COLOR.white?c.textContent=8-a:c.textContent=1+a}}}},{key:"drawPiecesDebounced",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.chessboard.state.squares,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;window.clearTimeout(this.drawPiecesDebounce),this.drawPiecesDebounce=setTimeout(function(){e.drawPieces(t),i&&i()})}},{key:"drawPieces",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.chessboard.state.squares;this.piecesGroup.firstChild;)this.piecesGroup.removeChild(this.piecesGroup.lastChild);for(var t=0;t<64;t++){var i=e[t];i&&this.drawPiece(t,i)}}},{key:"drawPiece",value:function(e,t){var i=d.Svg.addElement(this.piecesGroup,"g");i.setAttribute("data-piece",t),i.setAttribute("data-index",e);var s=this.squareIndexToPoint(e),n=this.svg.createSVGTransform();n.setTranslate(s.x,s.y),i.transform.baseVal.appendItem(n);var r=d.Svg.addElement(i,"use",{href:"#"+t,class:"piece"}),a=this.svg.createSVGTransform();a.setTranslate(this.pieceXTranslate,0),r.transform.baseVal.appendItem(a);var o=this.svg.createSVGTransform();return o.setScale(this.scalingY,this.scalingY),r.transform.baseVal.appendItem(o),i}},{key:"setPieceVisibility",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=this.getPiece(e);t?i.setAttribute("visibility","visible"):i.setAttribute("visibility","hidden")}},{key:"getPiece",value:function(e){return this.piecesGroup.querySelector("g[data-index='"+e+"']")}},{key:"drawMarkersDebounced",value:function(){var e=this;window.clearTimeout(this.drawMarkersDebounce),this.drawMarkersDebounce=setTimeout(function(){e.drawMarkers()},10)}},{key:"drawMarkers",value:function(){for(var t=this;this.markersGroup.firstChild;)this.markersGroup.removeChild(this.markersGroup.firstChild);this.chessboard.state.markers.forEach(function(e){t.drawMarker(e)})}},{key:"drawMarker",value:function(e){var t=d.Svg.addElement(this.markersGroup,"g");t.setAttribute("data-index",e.index);var i=this.squareIndexToPoint(e.index),s=this.svg.createSVGTransform();s.setTranslate(i.x,i.y),t.transform.baseVal.appendItem(s);var n=d.Svg.addElement(t,"use",{href:"#"+e.type.slice,class:"marker "+e.type.class}),r=this.svg.createSVGTransform();return r.setScale(this.scalingX,this.scalingY),n.transform.baseVal.appendItem(r),t}},{key:"animatePieces",value:function(e,t,i){this.animationQueue.push({fromSquares:e,toSquares:t,callback:i}),this.animationRunning||this.nextPieceAnimationInQueue()}},{key:"nextPieceAnimationInQueue",value:function(){var e=this,t=this.animationQueue.shift();void 0!==t&&(this.currentAnimation=new o.ChessboardPiecesAnimation(this,t.fromSquares,t.toSquares,this.chessboard.props.animationDuration/(this.animationQueue.length+1),function(){e.moveInput.dragablePiece||e.drawPieces(t.toSquares),e.nextPieceAnimationInQueue(),t.callback&&t.callback()}))}},{key:"moveStartCallback",value:function(e){return!this.chessboard.moveInputCallback||this.chessboard.moveInputCallback({chessboard:this.chessboard,type:l.INPUT_EVENT_TYPE.moveStart,square:r.SQUARE_COORDINATES[e]})}},{key:"moveDoneCallback",value:function(e,t){return!this.chessboard.moveInputCallback||this.chessboard.moveInputCallback({chessboard:this.chessboard,type:l.INPUT_EVENT_TYPE.moveDone,squareFrom:r.SQUARE_COORDINATES[e],squareTo:r.SQUARE_COORDINATES[t]})}},{key:"moveCanceledCallback",value:function(){this.chessboard.moveInputCallback&&this.chessboard.moveInputCallback({chessboard:this.chessboard,type:l.INPUT_EVENT_TYPE.moveCanceled})}},{key:"setCursor",value:function(){var e=this;this.chessboard.initialization.then(function(){e.chessboard.state.inputWhiteEnabled||e.chessboard.state.inputBlackEnabled?e.boardGroup.setAttribute("class","board input-enabled"):e.boardGroup.setAttribute("class","board")})}},{key:"squareIndexToPoint",value:function(e){var t=void 0,i=void 0;return this.chessboard.state.orientation===l.COLOR.white?(t=this.borderSize+e%8*this.squareWidth,i=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,i=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:i}}}]),s}()).spriteLoadingStatus=h},{"../svjs-svg/src/svjs-svg/Svg.js":6,"./Chessboard.js":1,"./ChessboardMoveInput.js":2,"./ChessboardPiecesAnimation.js":3,"./ChessboardState.js":4}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}();var a="http://www.w3.org/2000/svg";"function"!=typeof NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);i.Svg=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return s(e,null,[{key:"createSvg",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=document.createElementNS(a,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}},{key:"addElement",value:function(e,t,i){var s=document.createElementNS(a,t);for(var n in"use"===t&&(i["xlink:href"]=i.href),i)if(-1!==n.indexOf(":")){var r=n.split(":");s.setAttributeNS("http://www.w3.org/1999/"+r[0],r[1],i[n])}else s.setAttribute(n,i[n]);return e.appendChild(s),s}},{key:"removeElement",value:function(e){e.parentNode.removeChild(e)}},{key:"loadSprite",value:function(e,i,s){var n=this,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,h=new XMLHttpRequest;h.open("GET",e),h.send(),h.onload=function(){var e=h.response,r=(new DOMParser).parseFromString(e,"image/svg+xml"),t=n.createSvg(document.body);t.setAttribute("style","display: none");var a=n.addElement(t,"defs");i.forEach(function(e){var t=r.getElementById(e);if(t){for(var i=t.transform.baseVal,s=0;s<i.numberOfItems;s++){var n=i.getItem(s);2===n.type&&n.setTranslate(n.matrix.e%o,n.matrix.f%o)}!function t(e){e.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&(e.removeAttribute("id"),e.hasChildNodes()&&t(e.childNodes))})}(t.childNodes),a.appendChild(t)}else console.error("error, node id="+e+" not found in sprite")}),s(t)}}}]),e}()},{}]},{},[6,5,1,2,4,3]);